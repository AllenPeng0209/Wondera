# 语言恋爱 + AI 恋爱游戏路线图与现状盘点（V0.1）

## 当前实现快照（基于 apps/mobile 源码）
- 客户端：React Native + Expo，三栏导航（消息/发现/我的）。
- 本地数据：SQLite（expo-sqlite），表有 roles/conversations/messages/user_settings/role_settings/liked_roles；支持角色创建、对话历史、消息删除。
- AI 回复：接入百炼 Qwen 文本对话（generateAiReply），无学习纠错/评分逻辑；脚本 fallback；历史截断（12 条）。
- 触达：后台“拍一拍”任务（expo-background-fetch + local notification），按时间间隔给出 AI 主动消息；首启注册通知权限。
- TTS：Qwen TTS HTTP 接口封装（synthesizeQwenTts）；前端音频存储字段已预留（audio_url/mime/duration）。
- UI 模块：角色发现卡片、角色创建、角色偏好/屏蔽、聊天偏好（气泡、沉浸模式、滑动回复等待）、API 设置（自填 key）、钱包（本地余额充值）等。
- 后端：`services/backend/` 已接入 FastAPI + Supabase（角色/探索/任务管理），其余业务仍以客户端本地为主。

## PRD 功能覆盖差距
| 模块 | PRD 目标 | 当前实现 | 缺口/动作 |
| --- | --- | --- | --- |
| 词汇/SRS | 语境词卡、SRS 闪卡闯关、发音练习 | 无词汇表/复习逻辑 | 设计 vocab 表与复习计划、生成语境卡（从对话提取/人工配置）、SRS 队列与闯关 UI；弱项词单独复习；与好感/奖励挂钩 |
| 对话剧场 + 纠错 | 分支剧情、语言正确度影响好感，实时纠错/示范 | 自由对话，无纠错/分支；好感度字段缺失 | 增加 dialog script/branch 模型、选择式回复组件、纠错/替换建议、好感度/语言分数写入 DB；剧情解锁逻辑 |
| AI 恋爱陪伴 | 自由聊、主动触达、情感档案 | 自由聊 + 背景拍一拍；无情感档案/话题引导 | 增加情感/偏好画像存储，话题计划器；拍一拍逻辑需结合学习目标与任务提醒 |
| 语音/口语评分 | 跟读打分、ASR、语速模式 | 仅 TTS 播报；无 ASR/评分 | 选型 ASR/评分服务，音频录制上传，评分结果展示与弱项词反馈；字幕/语速模式切换 |
| 写作/日记批改 | 日记改写、评分、错误热点 | 无写作入口 | 日记输入界面，批改 API，错误标注与改写建议，周报汇总 |
| 文化/场景任务 | 约会地点词包、节日热点剧情 | 无场景系统 | 场景/词包数据结构与 UI，触发式任务与限定剧情；资源管理（图片/配置） |
| 成长与任务 | 每日/每周任务、等级、好感特技 | 无任务/等级；仅本地余额 | 任务/等级表，打卡与提醒，奖励与解锁逻辑；好感特技切换（直接/温柔纠错） |
| 社交/排行榜 | CP 亲密度榜、协作对话赛 | 无 | 排行与协作模式设计、评分裁判、节奏控制；后端榜单服务 |
| 付费 | 会员、道具、词包/剧情解锁 | 本地余额假充值，无 IAP | IAP/渠道支付接入、权益/库存管理、道具消费逻辑、风控与收据校验 |
| 数据与难度 | 仪表盘、动态难度 | 无埋点/仪表盘 | 埋点方案（RN SDK + 本地缓存）、学习/好感指标仪表盘、动态难度策略（词难度/语速/提示强度） |
| 安全/合规 | 内容分级、敏感过滤 | 未见 | LLM 前置过滤、未成年人模式、举报/拉黑管道、TOS/隐私弹窗与存证 |

## 开发路线图（建议 3 阶段）
- 阶段 0：基础铺垫（~1 周）
  - 设计数据库迁移方案（新增 vocab/tasks/affection/diary 等表）；抽象 Remote Config/feature flag。
  - 补齐埋点/崩溃监控框架，定义关键事件（词汇练习、纠错采纳、任务完成等）。
  - 明确 ASR/评分/纠错服务选型与鉴权方案，准备 Mock API 以便前端先行。

- 阶段 1：MVP（~3 周，对应 PRD MVP）
  - 词汇与 SRS：语境词卡生成、闪卡复习、SRS 队列存储、闯关奖励（好感/道具）。
  - 对话剧场：选项式回复 + 分支脚本模型、基础纠错与示范、好感度写入与解锁。
  - 成长与任务：每日/每周任务、好感进度条、奖励发放；仪表盘初版（词汇掌握、对话轮次）。
  - 支撑：内容安全前置过滤、未成年模式、简单 IAP 沙盒（至少本地模拟 + 接入管线）。

- 阶段 2：语音与写作（~3 周）
  - 语音跟读/口语评分：录音 + ASR + 音素级反馈，护航/沉浸字幕模式。
  - 日记/写作批改：日记输入、错误高亮、改写建议、周报。
  - 场景词包：约会地点词包与小任务，结合 SRS 与对话剧场。
  - 拍一拍升级：结合任务/学习目标的主动触达，避免纯陪聊打扰。

- 阶段 3：深化与运营（~2-3 周）
  - 动态难度引擎：根据完成率/评分自动调整词难度、语速、提示强度。
  - 社交/排行榜与协作对话赛，AI 裁判评分。
  - 会员/道具全链路：IAP/渠道支付、权益生效、道具消费与风控，节日/热点活动模版化。
  - 合规与安全加固：内容分级、敏感场景屏蔽、举报/封禁流程、隐私协议落地。

## 立即待办（为进入阶段 0）
- 确认口语评分/ASR 服务与纠错模型方案，出接口契约。
- 定义数据库迁移列表（vocab/tasks/affection/diary/scene），评估老数据兼容。
- 确认 IAP/渠道支付接入策略与最小可用流程（是否需先 Mock）。
