# Dreamate 角色成长与游戏化 PRD

## 1. 目标
- 让语言学习过程“可视化成长”：角色等级、亲密度与状态随学习行为升级，形成正反馈。
- 建立可扩展的任务/成就框架，后续可串联每日剧场、SRS 词卡、连胜/连击等事件。
- 保持本地优先：全部状态本地存储，离线可见；后续需要时再做云同步。

## 2. 核心概念
- **角色等级 (Level)**：随经验值 (EXP) 提升；EXP 主要来源于对话、剧场任务、使用目标词。
- **亲密度 (Affection)**：按角色累积，主要由完成任务、优质对话获得；分档显示“亲密等级”。
- **状态/称号**：根据等级或亲密度解锁的轻量称号或装饰（首版先预留字段，不强制展示）。

## 3. 进度规则
- 经验阈值：`next_exp = 50 * level^1.5`（平滑成长曲线）。
- 亲密度阈值（示例）：`[0, 60, 150, 320, 520, 800]`，超过列表按每级 +300 递增。
- 升级时保留溢出 EXP；亲密度同理。

### 经验来源（首版）
- 对话：每条用户消息 +5~15 EXP（按字数上限），亲密度 +0~3（防滥刷）。
- 每日剧场：完成后按难度授予 EXP（中阶 +20，进阶 +30），亲密度按 `reward_points` 增加。
- 词汇使用（留接口）：后续可检测目标词使用给予额外 EXP +10。

## 4. UI/交互
- **每日剧场卡片**：显示角色等级/亲密度条；完成后弹“升级/亲密提升” Toast（首版可仅内存提示）。
- **对话页头部（后续迭代）**：可展示等级徽章、亲密度进度，点击查看详情。
- **角色档案（后续）**：集中展示等级、亲密度、已解锁称号/皮肤。

## 5. 数据与接口
- 表：`role_settings` 新增 `level INTEGER DEFAULT 1`, `exp INTEGER DEFAULT 0`, `affection INTEGER DEFAULT 0`, `affection_level INTEGER DEFAULT 1`。
- 函数：`addRoleProgress(roleId, { expDelta, affectionDelta })` 处理升级/亲密分档；`getRoleProgress(roleId)` 返回进度 + 下一档阈值。
- 任务：`completeDailyTask` 里调用 `addRoleProgress`；对话 `handleSend` 里记录基础 EXP/亲密。

## 6. 上线范围（首版 MVP）
- 实现数据库字段、进度计算、每日剧场和对话两处的进度累积。
- 剧场卡片展示等级/亲密度进度；升级逻辑在后台完成，暂不做全局弹窗（避免打扰）。

## 7. 验收标准
- 新用户可看到等级/亲密度条，初始值 Lv.1，0/50 EXP。
- 完成一次每日剧场后：角色 EXP、亲密度有增长，卡片进度变化，数据库有记录。
- 对话发送多条后：EXP 递增且可升级，亲密度随消息略增；不会影响旧数据（旧角色默认 Lv.1）。
- 旧用户不会崩溃：缺失列会自动补齐，默认值正确。

## 8. 迭代预留
- 连续学习天数（streak）加成；
- 称号/皮肤解锁；
- 任务/成就清单；
- 词汇命中检测的奖励；
- 云同步与反作弊（例如限速奖励）。
